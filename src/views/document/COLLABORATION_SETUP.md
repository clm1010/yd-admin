# 多人协同编辑 - 光标显示功能说明

## 功能概述

本功能实现了多人协同编辑时，在文档中显示各用户的光标位置和用户名，方便区分不同用户在线协同编辑的位置。

## 技术实现

### 1. 依赖包

已安装以下依赖包：

- `yjs`: ^13.6.27 - CRDT 协同编辑核心库
- `y-websocket`: ^3.0.0 - WebSocket 通信层
- `y-prosemirror`: ^1.3.7 - 连接 Tiptap 和 Y.js
- `@umoteam/editor`: ^8.1.0 - 编辑器组件

### 2. 配置更改

#### editorConfig.ts

- 添加了 `getCollaborationOptions` 函数，用于生成协同编辑配置
- 配置包含 Y.Doc、Provider 和用户信息（名称、颜色）

#### UmoCollaborativeEditor.vue

- 动态配置编辑器选项，在 Provider 初始化后传递协同配置
- 通过 `provider.awareness` 设置用户感知信息
- 添加了协同光标的 CSS 样式

### 3. 工作原理

1. **初始化阶段**：

   - 创建 Y.Doc 实例（CRDT 文档）
   - 创建 WebsocketProvider 连接到协同服务器
   - 设置当前用户的感知信息（名称、颜色、角色）

2. **光标同步**：

   - 通过 `provider.awareness` 广播用户光标位置
   - 其他用户通过监听 `awareness.change` 事件接收光标信息
   - Umo Editor 自动渲染其他用户的光标

3. **样式展示**：
   - 光标使用 `.collaboration-cursor__caret` 类显示为竖线
   - 用户名使用 `.collaboration-cursor__label` 类显示在光标上方
   - 每个用户的光标颜色通过 CSS 变量 `--cursor-color` 动态设置

## 使用示例

```vue
<UmoEditor v-bind="editorOptions" />
```

编辑器会自动：

- 显示当前用户的光标（本地）
- 显示其他在线用户的光标和用户名（远程）
- 实时同步光标位置变化

## 光标样式

光标显示特点：

- **光标线条**：1px 宽的竖线，使用用户专属颜色
- **用户名标签**：显示在光标上方，背景色与光标颜色一致
- **字体样式**：12px，加粗，白色文字
- **定位**：绝对定位在光标位置上方 1.4em

## 测试方法

1. 打开两个浏览器窗口或标签页
2. 访问同一文档（使用相同的 docId）
3. 在任一窗口中移动光标或输入内容
4. 另一个窗口会实时显示该用户的光标位置和用户名

## 注意事项

1. **WebSocket 连接**：确保后端 WebSocket 服务器正常运行（端口 3001）
2. **文档 ID**：相同文档的用户必须使用相同的 docId
3. **用户颜色**：每个用户会随机分配一个颜色，用于区分光标
4. **感知信息**：包含用户名、颜色、角色和加入时间

## 后续优化建议

1. 允许用户自定义名称和头像
2. 添加光标跟随功能（点击用户列表中的用户，跳转到其光标位置）
3. 显示用户选中的文本范围（高亮）
4. 优化光标动画效果
5. 添加用户在线/离线通知
